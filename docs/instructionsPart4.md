# Spring Bootcamp Step 4

In this step you will create a REST controller that interacts with a JPA data source for CRUD operations.

## Create the JPA 

This section is about using Spring JPA with an in memory database.

1. Create the domain class `com.dmi.bootcamp.dmibank.domain.Person`. It should have an `id`, `firstName`, and `lastName`. The `id` should be an autogenerated JPA id field.

2. Create the JPA repository `com.dmi.bootcamp.dmibank.data.PersonRepository`. It should have a method that can be used to find a person by first name and last name.

3. Create the `com.dmi.bootcamp.dmibank.http.PersonController` for the REST interface. The controller should have these methods:

    | Method | HTTP Method | URL | Body | Return Codes |
    |--------|-------------|-----|------|--------------|
    | insert | POST | /person | Json for a Person | CONFLICT if the person already exists. Otherwise CREATED and set a Location response header with the find URL|
    | find by id | GET | /person/{id} | N/A | OK or NOT_FOUND |
    | find all | GET | /person | N/A | OK |
    | update | PUT | /person/{id} | Json for a Person | OK and return the updated Person, or NOT_FOUND |
    | delete | DELETE | /person/{id} | N/A | NO_CONTENT or NOT_FOUND |

4. Run your application locally and test it with the Swagger UI.

## Using PostgreSQL in the Cloud

1. Create a free PostgreSQL service on Cloud Foundry

    `cf create-service elephantsql turtle postgresql`

2. Alter the application configuration:

    - In your CloudConfiguration class, add the following

        ```java
        @Bean
        public DataSource datasource() {
          return connectionFactory().dataSource();
        }
        ```
    - Create a file named `application-cloud.properties` in `src/main/resources`. Add the setting `spring.jpa.hibernate.ddl-auto=update` to the file

    - Alter your `manifest.yml` to add the PostgreSQL service:

        ```yaml
        services:
        - redis
        - postgresql
        ```
3. Build and push your updated application. Add a few records and verify that the records persis after stoppping and restarting the application

## Reference

Good reference articles:

https://dzone.com/articles/leverage-http-status-codes-to-build-a-rest-service

https://spring.io/blog/2015/04/27/binding-to-data-services-with-spring-boot-in-cloud-foundry
